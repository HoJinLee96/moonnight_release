<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{main/base}">

<head>
	<title>질문 등록</title>
	<style>
		.container {
			width: 80%;
			margin: 0 auto;
			padding: 20px;
		}

		.register-form {
			display: flex;
			flex-direction: column;
			gap: 15px;
			/* 항목 간 간격 */
			margin-top: 20px;
			padding: 20px;
			border: 1px solid #ddd;
			border-radius: 8px;
		}

		.form-group {
			display: flex;
			flex-direction: column;
		}

		.form-group label {
			margin-bottom: 5px;
			font-weight: bold;
		}

		.form-group input[type="text"],
		.form-group input[type="password"],
		.form-group textarea {
			padding: 10px;
			border: 1px solid #ccc;
			border-radius: 4px;
			font-size: 16px;
		}

		.form-group textarea {
			height: 200px;
			resize: vertical;
		}

		.button-container {
			display: flex;
			justify-content: flex-end;
			gap: 10px;
			margin-top: 20px;
		}

		.button-container button {
			padding: 10px 20px;
			border: none;
			border-radius: 5px;
			cursor: pointer;
			font-size: 16px;
		}

	</style>
</head>

<main layout:fragment="content">
	<div class="container">
		<h2>질문 등록</h2>

		<form id="questionRegisterForm" class="register-form" autocomplete="off">
			<div class="form-group">
				<label for="title">제목</label>
				<input type="text" id="title" name="title" placeholder="제목을 입력하세요" required autocomplet="off">
			</div>

			<div class="form-group">
				<label for="content">내용</label>
				<textarea id="content" name="content" placeholder="내용을 입력하세요" required></textarea>
			</div>

			<div class="form-group">
				<label for="password">비밀번호</label>
				<input type="password" id="password" name="password" placeholder="비밀번호 숫자 4자리를 입력하세요" required
					maxlength="4">
			</div>

			<div class="button-container">
				<button type="button" class="btn btn-secondary cancel-btn" onclick="location.href='/question'">취소</button>
				<button type="submit" class="btn btn-primary-mini submit-btn">등록</button>
			</div>
		</form>
	</div>
</main>

<th:block layout:fragment="script">
	<script type="module">
		import {registerQuestion} from '/js/question.js';
		import {initQuestionPasswordFormatting} from '/js/format.js';

		document.addEventListener("DOMContentLoaded", () => {

			initQuestionPasswordFormatting(document.getElementById('password'));
			
			const form = document.getElementById('questionRegisterForm');

			form.addEventListener('submit', async (event) => {
				event.preventDefault(); // 폼의 기본 제출 동작을 막습니다.

				// 입력 값 가져오기
				const title = document.getElementById('title').value;
				const content = document.getElementById('content').value;
				const password = document.getElementById('password').value;

				// 간단한 유효성 검사
				if (!title.trim()) {
					alert("제목을 입력해주세요.");
					return;
				}
				if (!content.trim()) {
					alert("내용을 입력해주세요.");
					return;
				}
				// 비밀번호 유효성 검사 수정 (숫자 여부 제거, 길이만 확인)
				if (!password || password.length != 4) {
					alert("비밀번호는 4자로 입력해주세요.");
					return;
				}

				// isSecret 필드 제거
				const questionData = {
					title,
					content,
					password
				};

				try {
					// API 호출
					await registerQuestion(questionData);
					alert("질문이 성공적으로 등록되었습니다.");
					// 등록 성공 후 목록 페이지로 이동
					location.href = '/question';
				} catch (error) {
					// 에러 발생 시 question.js의 handleApiError에서 alert를 이미 처리합니다.
					console.error("Registration failed:", error);
				}
			});
		});
	</script>
</th:block>

</html>